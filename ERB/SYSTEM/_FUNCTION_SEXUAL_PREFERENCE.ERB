;--------------------------------
;性的嗜好の変化を行う
;ARG:0は対象キャラ
;ARG:1はもし変化したらロック性的嗜好を弄るフラグ
;--------------------------------
@CHECK_SEXUAL_PREFERENCE(ARG:0, ARG:1 = 0)
#DIM 嗜好候補, 15
#DIM 候補用配列_愛撫する     = 0    , 1    , 2    , 3    , 4    , 5    , 6    , 7    , 8    , 20   , 33   , 43   , 60   , 100  , 103
#DIM 候補用配列_奉仕する     = 10   , 11   , 12   , 13   , 14   , 15   , 16   , 17   , 20   , 90   , 104  , 106  , 107  , 210
{
#DIM 候補用配列_性交する     = 6    , 7    , 21   , 22   , 30   , 31   , 32   , 33   , 34   , 35   , 36   , 37   , 38   , 39   ,
                               40,    41   , 42   , 43   , 44   , 45   , 46   , 47   , 48   , 49   , 51   , 52   , 53   , 55   , 56   , 57   , 58   , 108  , 109  , 160  , 161
}
#DIM 候補用配列_道具使う     = 16   , 22   , 60   , 61   , 62   , 63   , 64   , 65   , 66   , 70   , 71   , 72   , 73   , 74   , 82   , 83   , 84   , 85   , 86   , 91   , 92   , 93   , 140  , 142
#DIM 候補用配列_ＳＭする     = 80   , 81   , 82   , 83   , 84   , 85   , 86   , 87   , 88   , 89   , 90   , 91   , 92   , 93   , 97   , 98
#DIM 候補用配列_羞恥する     = 100  , 101  , 102  , 103  , 104  , 105  , 106  , 107  , 108  , 109  , 110  , 111  , 112  , 113  , 114  , 130  , 131  , 132  , 140  , 141  , 142  , 150  , 151  , 211
#DIM 候補用配列_触手する     = 200  , 201  , 202  , 203  , 204  , 205  , 206  , 207  , 208  , 210  , 211  , 212  , 213
#DIM 候補用配列_愛撫される   = 1000 , 1001 , 1002 , 1003 , 1004 , 1005 , 1006 , 1007 , 1008 , 1020 , 1033 , 1043 , 1060 , 1100 , 1103
#DIM 候補用配列_奉仕される   = 1010 , 1011 , 1012 , 1013 , 1014 , 1015 , 1016 , 1017 , 1020 , 1090 , 1104 , 1106 , 1107 , 1210
{
#DIM 候補用配列_性交される   = 1006 , 1007 , 1021 , 1022 , 1030 , 1031 , 1032 , 1033 , 1034 , 1035 , 1036 , 1037 , 1038 , 1039 ,
                               1040 , 1041 , 1042 , 1043 , 1044 , 1045 , 1046 , 1051 , 1052 , 1053 , 1055 , 1056 , 1057 , 1058 , 1108 , 1109 , 1160 , 1161 , 1201 , 1202
}
#DIM 候補用配列_道具使われる = 1016 , 1022 , 1060 , 1061 , 1062 , 1063 , 1064 , 1065 , 1066 , 1070 , 1071 , 1072 , 1073 , 1074 , 1082 , 1083 , 1084 , 1085 , 1086 , 1091 , 1092 , 1093 , 1140 , 1142
#DIM 候補用配列_ＳＭされる   = 1080 , 1081 , 1082 , 1083 , 1084 , 1085 , 1086 , 1087 , 1088 , 1089 , 1090 , 1091 , 1092 , 1093 , 1097 , 1098
#DIM 候補用配列_羞恥される   = 1100 , 1101 , 1102 , 1103 , 1104 , 1105 , 1106 , 1107 , 1108 , 1109 , 1110 , 1111 , 1112 , 1113 , 1114 , 1130 , 1131 , 1132 , 1140 , 1141 , 1142 , 1150 , 1151 , 1211
#DIM 候補用配列_触手される   = 1200 , 1201 , 1202 , 1203 , 1204 , 1205 , 1206 , 1207 , 1208 , 1210 , 1211 , 1212 , 1213

VARSET 嗜好候補

FOR LOCAL, 0, VARSIZE("候補用配列_愛撫する")
	嗜好候補:性的嗜好_愛撫する += COM_EXP:(ARG:0):(候補用配列_愛撫する:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_奉仕する")
	嗜好候補:性的嗜好_奉仕する += COM_EXP:(ARG:0):(候補用配列_奉仕する:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_性交する")
	嗜好候補:性的嗜好_性交する += COM_EXP:(ARG:0):(候補用配列_性交する:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_道具使う")
	嗜好候補:性的嗜好_道具使う += COM_EXP:(ARG:0):(候補用配列_道具使う:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_ＳＭする")
	嗜好候補:性的嗜好_ＳＭする += COM_EXP:(ARG:0):(候補用配列_ＳＭする:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_羞恥する")
	嗜好候補:性的嗜好_羞恥する += COM_EXP:(ARG:0):(候補用配列_羞恥する:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_触手する")
	嗜好候補:性的嗜好_触手する += COM_EXP:(ARG:0):(候補用配列_触手する:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_愛撫される")
	嗜好候補:性的嗜好_愛撫される += COM_EXP:(ARG:0):(候補用配列_愛撫される:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_奉仕される")
	嗜好候補:性的嗜好_奉仕される += COM_EXP:(ARG:0):(候補用配列_奉仕される:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_性交される")
	嗜好候補:性的嗜好_性交される += COM_EXP:(ARG:0):(候補用配列_性交される:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_道具使われる")
	嗜好候補:性的嗜好_道具使われる += COM_EXP:(ARG:0):(候補用配列_道具使われる:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_ＳＭされる")
	嗜好候補:性的嗜好_ＳＭされる += COM_EXP:(ARG:0):(候補用配列_ＳＭされる:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_羞恥される")
	嗜好候補:性的嗜好_羞恥される += COM_EXP:(ARG:0):(候補用配列_羞恥される:LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("候補用配列_触手される")
	嗜好候補:性的嗜好_触手される += COM_EXP:(ARG:0):(候補用配列_触手される:LOCAL)
NEXT

FOR LOCAL, 0, VARSIZE("嗜好候補")
	嗜好候補:LOCAL /= 100
NEXT

LOCAL = FINDELEMENT(嗜好候補, MAXARRAY(嗜好候補))
LOCAL:1 = 嗜好候補:LOCAL
嗜好候補:LOCAL = 0
LOCAL:2 = FINDELEMENT(嗜好候補, MAXARRAY(嗜好候補))
LOCAL:3 = 嗜好候補:(LOCAL:2)

LOCAL:4 = TALENT:(ARG:0):性的嗜好
LOCAL:5 = TALENT:(ARG:0):性的嗜好ロック


IF ARG:1 == 0
	;一番経験した嗜好が二番目より結構大きければ変化する。
	;性的嗜好がロックされると基準ががくんと厳しくなる
	IF LOCAL:1 - LOCAL:3 >= LOCAL:5  * 3 + 3
		TALENT:(ARG:0):性的嗜好 = LOCAL
		TALENT:(ARG:0):性的嗜好ロック = 0
	;上記条件を見たさず、かつ性的嗜好がロックされていなければ元の嗜好にもどす
	ELSEIF !LOCAL:5
		;CSVが定義されていればそこから拾う。定義がなければなし。
		IF EXISTCSV(NO:(ARG:0))
			CSVTALENT NO:(ARG:0), 334
			TALENT:(ARG:0):性的嗜好 = RESULT
		ELSE
			TALENT:(ARG:0):性的嗜好 = 0
		ENDIF
	ENDIF
	;性的嗜好が変化した場合はメッセージを表示。
	IF TALENT:(ARG:0):性的嗜好 != LOCAL:4
		;ロックされていた場合
		IF LOCAL:5
			CALL COLORPRINT(@"%ANAME(ARG:0)%は他の者に刻まれた嗜好を忘れ、新たに「%TOSTR_SEXUAL_PREFERENCE(TALENT:(ARG:0):性的嗜好)%」を好むようになった", カラー_ピンク, "W")
		ELSE
			CALL COLORPRINT(@"%ANAME(ARG:0)%の性的嗜好が、「%TOSTR_SEXUAL_PREFERENCE(TALENT:(ARG:0):性的嗜好)%」に変化した", カラー_ピンク, "W")
		ENDIF
	ENDIF
;ロックフラグが立っている場合
ELSE
	;ロックフラグが立っているときは判定は易しめ　ただしロックがかかるのは、一番高い嗜好候補と現在の嗜好が異なる場合のみ
	;なお、ロックによる判定難化はない
	;通らなかったら何もしない
	IF LOCAL:1 - LOCAL:3 >= 2 && TALENT:(ARG:0):性的嗜好 != LOCAL:1
		TALENT:(ARG:0):性的嗜好 = LOCAL
		TALENT:(ARG:0):性的嗜好ロック = 1
	ENDIF
	;変化した場合
	IF TALENT:(ARG:0):性的嗜好 != LOCAL:4
		CALL COLORPRINT(@"%ANAME(ARG:0)%は、他の者に抱かれることを繰り返し、「%TOSTR_SEXUAL_PREFERENCE(TALENT:(ARG:0):性的嗜好)%」を好むようになった", カラー_ピンク, "W")
	ENDIF
ENDIF

;--------------------------------
;ARG:0に、ARG:1に対応するランダムなCOM_EXPをARG:2だけ取得させる
;--------------------------------
@GET_RANDOM_SEXUAL_PREFERENCE_EXP(ARG:0, ARG:1, ARG:2)
#DIM コマンド
#DIM 候補用配列_愛撫する     = 0    , 1    , 2    , 3    , 4    , 5    , 6    , 7    , 8    , 20   , 33   , 43   , 60   , 100  , 103
#DIM 候補用配列_奉仕する     = 10   , 11   , 12   , 13   , 14   , 15   , 16   , 17   , 20   , 90   , 104  , 106  , 107  , 210
{
#DIM 候補用配列_性交する     = 6    , 7    , 21   , 22   , 30   , 31   , 32   , 33   , 34   , 35   , 36   , 37   , 38   , 39   ,
                               40,    41   , 42   , 43   , 44   , 45   , 46   , 47   , 48   , 49   , 51   , 52   , 53   , 55   , 56   , 57   , 58   , 108  , 109  , 160  , 161
}
#DIM 候補用配列_道具使う     = 16   , 22   , 60   , 61   , 62   , 63   , 64   , 65   , 66   , 70   , 71   , 72   , 73   , 74   , 82   , 83   , 84   , 85   , 86   , 91   , 92   , 93   , 140  , 142
#DIM 候補用配列_ＳＭする     = 80   , 81   , 82   , 83   , 84   , 85   , 86   , 87   , 88   , 89   , 90   , 91   , 92   , 93   , 97   , 98
#DIM 候補用配列_羞恥する     = 100  , 101  , 102  , 103  , 104  , 105  , 106  , 107  , 108  , 109  , 110  , 111  , 112  , 113  , 114  , 130  , 131  , 132  , 140  , 141  , 142  , 150  , 151  , 211
#DIM 候補用配列_触手する     = 200  , 201  , 202  , 203  , 204  , 205  , 206  , 207  , 208  , 210  , 211  , 212  , 213
#DIM 候補用配列_愛撫される   = 1000 , 1001 , 1002 , 1003 , 1004 , 1005 , 1006 , 1007 , 1008 , 1020 , 1033 , 1043 , 1060 , 1100 , 1103
#DIM 候補用配列_奉仕される   = 1010 , 1011 , 1012 , 1013 , 1014 , 1015 , 1016 , 1017 , 1020 , 1090 , 1104 , 1106 , 1107 , 1210
{
#DIM 候補用配列_性交される   = 1006 , 1007 , 1021 , 1022 , 1030 , 1031 , 1032 , 1033 , 1034 , 1035 , 1036 , 1037 , 1038 , 1039 ,
                               1040 , 1041 , 1042 , 1043 , 1044 , 1045 , 1046 , 1051 , 1052 , 1053 , 1055 , 1056 , 1057 , 1058 , 1108 , 1109 , 1160 , 1161 , 1201 , 1202
}
#DIM 候補用配列_道具使われる = 1016 , 1022 , 1060 , 1061 , 1062 , 1063 , 1064 , 1065 , 1066 , 1070 , 1071 , 1072 , 1073 , 1074 , 1082 , 1083 , 1084 , 1085 , 1086 , 1091 , 1092 , 1093 , 1140 , 1142
#DIM 候補用配列_ＳＭされる   = 1080 , 1081 , 1082 , 1083 , 1084 , 1085 , 1086 , 1087 , 1088 , 1089 , 1090 , 1091 , 1092 , 1093 , 1097 , 1098
#DIM 候補用配列_羞恥される   = 1100 , 1101 , 1102 , 1103 , 1104 , 1105 , 1106 , 1107 , 1108 , 1109 , 1110 , 1111 , 1112 , 1113 , 1114 , 1130 , 1131 , 1132 , 1140 , 1141 , 1142 , 1150 , 1151 , 1211
#DIM 候補用配列_触手される   = 1200 , 1201 , 1202 , 1203 , 1204 , 1205 , 1206 , 1207 , 1208 , 1210 , 1211 , 1212 , 1213


SELECTCASE ARG:1
	CASE 性的嗜好_愛撫する
		コマンド = 候補用配列_愛撫する:(RAND:(VARSIZE("候補用配列_愛撫する")))
	CASE 性的嗜好_奉仕する
		コマンド = 候補用配列_奉仕する:(RAND:(VARSIZE("候補用配列_奉仕する")))
	CASE 性的嗜好_性交する
		コマンド = 候補用配列_性交する:(RAND:(VARSIZE("候補用配列_性交する")))
	CASE 性的嗜好_道具使う
		コマンド = 候補用配列_道具使う:(RAND:(VARSIZE("候補用配列_道具使う")))
	CASE 性的嗜好_ＳＭする
		コマンド = 候補用配列_ＳＭする:(RAND:(VARSIZE("候補用配列_ＳＭする")))
	CASE 性的嗜好_羞恥する
		コマンド = 候補用配列_羞恥する:(RAND:(VARSIZE("候補用配列_羞恥する")))
	CASE 性的嗜好_触手する
		コマンド = 候補用配列_触手する:(RAND:(VARSIZE("候補用配列_触手する")))
	CASE 性的嗜好_愛撫される
		コマンド = 候補用配列_愛撫される:(RAND:(VARSIZE("候補用配列_愛撫される")))
	CASE 性的嗜好_奉仕される
		コマンド = 候補用配列_奉仕される:(RAND:(VARSIZE("候補用配列_奉仕される")))
	CASE 性的嗜好_性交される
		コマンド = 候補用配列_性交される:(RAND:(VARSIZE("候補用配列_性交される")))
	CASE 性的嗜好_道具使われる
		コマンド = 候補用配列_道具使われる:(RAND:(VARSIZE("候補用配列_道具使われる")))
	CASE 性的嗜好_ＳＭされる
		コマンド = 候補用配列_ＳＭされる:(RAND:(VARSIZE("候補用配列_ＳＭされる")))
	CASE 性的嗜好_羞恥される
		コマンド = 候補用配列_羞恥される:(RAND:(VARSIZE("候補用配列_羞恥される")))
	CASE 性的嗜好_触手される
		コマンド = 候補用配列_触手される:(RAND:(VARSIZE("候補用配列_触手される")))
ENDSELECT
COM_EXP:(ARG:0):コマンド = ARG:2 * 10

IF コマンド >= 2000
	コマンド -= 2000
ELSEIF コマンド >= 1000
	コマンド -= 1000
ENDIF
CALL SET_COM_KNOWLEDGE(ARG:0, コマンド)
